<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha de Datos - Empresa Comunal Taca</title>
  <meta name="description" content="Formulario de postulación para la Empresa Comunal de Servicios Múltiples de la Comunidad Campesina de Taca">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #0973b0;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef } = React;

    // ========================================
    // CONFIGURACIÓN DEL FORMULARIO
    // ========================================
    
    // ⚠️ IMPORTANTE: REEMPLAZA ESTA URL CON LA URL DE TU GOOGLE APPS SCRIPT
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/TU_ID_DE_SCRIPT_AQUI/exec';
    
    // ========================================
    // COMPONENTES DE ICONOS SVG
    // ========================================
    const ChevronDown = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"></polyline></svg>;
    const ChevronUp = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="18 15 12 9 6 15"></polyline></svg>;
    const User = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
    const Users = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
    const GraduationCap = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>;
    const Briefcase = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>;
    const Paperclip = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>;
    const CheckCircle = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
    const AlertCircle = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;
    const Building2 = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"></path><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"></path><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"></path><path d="M10 6h4"></path><path d="M10 10h4"></path><path d="M10 14h4"></path><path d="M10 18h4"></path></svg>;
    const Spinner = ({size=24, className=""}) => <svg className={className} width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12a9 9 0 11-6.219-8.56"></path></svg>;

    // ========================================
    // COMPONENTES AUXILIARES
    // ========================================
    
    const FormInput = ({ label, name, type = "text", required = false, onChange, value, placeholder }) => (
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          {label} {required && <span className="text-red-600">*</span>}
        </label>
        <input
          type={type}
          name={name}
          onChange={onChange}
          value={value}
          placeholder={placeholder}
          required={required}
          className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0] focus:border-transparent transition"
        />
      </div>
    );

    const Section = ({ title, icon: Icon, expanded, onToggle, children }) => (
      <div className="bg-white rounded-xl shadow-md overflow-hidden transition-all">
        <button
          type="button"
          onClick={onToggle}
          className="w-full px-6 py-4 bg-gradient-to-r from-[#0973b0] to-[#075a90] text-white flex justify-between items-center hover:from-[#075a90] hover:to-[#054070] transition"
        >
          <div className="flex items-center gap-3">
            <Icon size={24} />
            <h3 className="text-lg font-semibold">{title}</h3>
          </div>
          {expanded ? <ChevronUp /> : <ChevronDown />}
        </button>
        {expanded && <div className="p-6">{children}</div>}
      </div>
    );

    const FileUpload = ({ label, required, keyName, onClick, onChange, selected, accept = "*" }) => {
      const fileInputRef = useRef(null);
      return (
        <div className="flex flex-col">
          <label className="text-sm font-medium text-gray-700 mb-2">
            {label} {required && <span className="text-red-600">*</span>}
          </label>
          <input
            ref={fileInputRef}
            type="file"
            onChange={onChange}
            accept={accept}
            className="hidden"
          />
          <button
            type="button"
            onClick={() => fileInputRef.current?.click()}
            className={`px-4 py-3 border-2 border-dashed rounded-lg hover:border-[#0973b0] transition flex items-center justify-center gap-2 ${
              selected ? 'border-green-500 bg-green-50' : 'border-gray-300'
            }`}
          >
            <Paperclip size={20} />
            {selected ? `✅ ${selected}` : 'Seleccionar archivo'}
          </button>
        </div>
      );
    };

    const MessageAlert = ({ type, text }) => {
      if (!text) return null;
      
      const bgColor = type === 'success' ? 'bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700';
      const Icon = type === 'success' ? CheckCircle : AlertCircle;
      
      return (
        <div className={`border px-4 py-3 rounded relative mb-4 ${bgColor}`} role="alert">
          <div className="flex items-center gap-2">
            <Icon size={20} />
            <span className="block sm:inline">{text}</span>
          </div>
        </div>
      );
    };

    // ========================================
    // COMPONENTE PRINCIPAL DEL FORMULARIO
    // ========================================
    
    function FichaDatos() {
      const [formData, setFormData] = useState({});
      const [expandedSections, setExpandedSections] = useState([0, 1, 2, 3, 4, 5, 6]);
      const [familiares, setFamiliares] = useState([{ id: 1 }]);
      const [contactosEmergencia, setContactosEmergencia] = useState([{ id: 1 }]);
      const [estudios, setEstudios] = useState([{ id: 1 }]);
      const [experiencias, setExperiencias] = useState([{ id: 1 }]);
      const [attachments, setAttachments] = useState({});
      const [uploadedFiles, setUploadedFiles] = useState({});
      const [loading, setLoading] = useState(false);
      const [submitMessage, setSubmitMessage] = useState({ type: '', text: '' });

      const handleChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData(prev => ({
          ...prev,
          [name]: type === 'checkbox' ? checked : value
        }));
      };

      const toggleSection = (id) => {
        setExpandedSections(prev =>
          prev.includes(id) ? prev.filter(s => s !== id) : [...prev, id]
        );
      };

      const handleFileChange = async (key, e) => {
        const file = e.target.files[0];
        if (file) {
          // Validar tamaño (máximo 10MB)
          if (file.size > 10 * 1024 * 1024) {
            setSubmitMessage({
              type: 'error',
              text: `El archivo ${file.name} es muy grande. Máximo 10MB permitido.`
            });
            e.target.value = '';
            return;
          }
          
          // Convertir a base64
          const reader = new FileReader();
          reader.onload = (event) => {
            setUploadedFiles(prev => ({
              ...prev,
              [key]: {
                name: file.name,
                type: file.type,
                content: event.target.result
              }
            }));
            setAttachments(prev => ({ ...prev, [key]: file.name }));
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = async (e) => {
        e?.preventDefault();
        
        // Validar que la URL esté configurada
        if (GOOGLE_SCRIPT_URL.includes('TU_ID_DE_SCRIPT_AQUI')) {
          setSubmitMessage({
            type: 'error',
            text: '⚠️ El formulario no está configurado. Por favor, configure la URL del Google Apps Script.'
          });
          return;
        }
        
        // Validar campos requeridos
        if (!formData.nombres || !formData.apellido_paterno || !formData.dni) {
          setSubmitMessage({
            type: 'error',
            text: 'Por favor complete los campos obligatorios: Nombres, Apellido Paterno y DNI'
          });
          return;
        }

        if (!formData.acepta_terminos) {
          setSubmitMessage({
            type: 'error',
            text: 'Debe aceptar los términos y condiciones para continuar'
          });
          return;
        }

        setLoading(true);
        setSubmitMessage({ type: '', text: '' });

        // Preparar datos estructurados
        const familiaresData = familiares.map(fam => ({
          nombres: formData[`familiar_${fam.id}_nombres`] || '',
          apellido_paterno: formData[`familiar_${fam.id}_apellido_paterno`] || '',
          apellido_materno: formData[`familiar_${fam.id}_apellido_materno`] || '',
          dni: formData[`familiar_${fam.id}_dni`] || '',
          parentesco: formData[`familiar_${fam.id}_parentesco`] || '',
          fecha_nacimiento: formData[`familiar_${fam.id}_fecha_nacimiento`] || ''
        }));

        const contactosData = contactosEmergencia.map(cont => ({
          nombre: formData[`contacto_${cont.id}_nombre`] || '',
          vinculo: formData[`contacto_${cont.id}_vinculo`] || '',
          telefono: formData[`contacto_${cont.id}_telefono`] || ''
        }));

        const estudiosData = estudios.map(est => ({
          nivel: formData[`estudio_${est.id}_nivel`] || '',
          institucion: formData[`estudio_${est.id}_institucion`] || '',
          especialidad: formData[`estudio_${est.id}_especialidad`] || '',
          grado: formData[`estudio_${est.id}_grado`] || '',
          anio_inicio: formData[`estudio_${est.id}_anio_inicio`] || '',
          anio_fin: formData[`estudio_${est.id}_anio_fin`] || ''
        }));

        const experienciasData = experiencias.map(exp => ({
          organizacion: formData[`exp_${exp.id}_org`] || '',
          cargo: formData[`exp_${exp.id}_cargo`] || '',
          tiempo: formData[`exp_${exp.id}_tiempo`] || '',
          motivo_cese: formData[`exp_${exp.id}_motivo`] || '',
          jefe: formData[`exp_${exp.id}_jefe`] || '',
          cargo_jefe: formData[`exp_${exp.id}_cargo_jefe`] || '',
          telefono_jefe: formData[`exp_${exp.id}_telefono_jefe`] || ''
        }));

        const dataToSend = {
          ...formData,
          familiares: familiaresData,
          contactos_emergencia: contactosData,
          estudios: estudiosData,
          experiencias: experienciasData,
          archivos: uploadedFiles
        };

        try {
          const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Importante para Google Apps Script
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(dataToSend)
          });

          // Con mode: 'no-cors' no podemos leer la respuesta,
          // pero si no hay error, asumimos que fue exitoso
          setSubmitMessage({
            type: 'success',
            text: '✅ ¡Postulación enviada exitosamente! Recibirá un correo de confirmación si proporcionó su email.'
          });
          
          // Scroll al mensaje
          window.scrollTo({ top: 0, behavior: 'smooth' });
          
          // Ofrecer limpiar formulario después de 3 segundos
          setTimeout(() => {
            if (confirm('¿Desea limpiar el formulario para un nuevo registro?')) {
              window.location.reload();
            }
          }, 3000);
          
        } catch (error) {
          console.error('Error:', error);
          setSubmitMessage({
            type: 'error',
            text: '❌ Error al enviar el formulario. Por favor verifique su conexión e intente nuevamente.'
          });
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 py-8 px-4">
          <div className="max-w-6xl mx-auto">
            {/* HEADER */}
            <div className="text-center mb-8">
              <div className="inline-block p-4 bg-white rounded-full shadow-lg mb-4">
                <Building2 size={48} className="text-[#0973b0]" />
              </div>
              <h1 className="text-4xl font-bold text-gray-800 mb-2">Ficha de Postulante</h1>
              <p className="text-gray-600">Empresa Comunal de Servicios Múltiples - Comunidad Campesina de Taca</p>
            </div>

            {/* MENSAJE DE ESTADO */}
            <MessageAlert type={submitMessage.type} text={submitMessage.text} />

            <form onSubmit={handleSubmit} className="space-y-6">
              {/* I. DATOS PERSONALES */}
              <Section title="I. Datos Personales" icon={User} expanded={expandedSections.includes(0)} onToggle={() => toggleSection(0)}>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <FormInput label="Apellido Paterno" name="apellido_paterno" required onChange={handleChange} />
                  <FormInput label="Apellido Materno" name="apellido_materno" onChange={handleChange} />
                  <FormInput label="Nombres" name="nombres" required onChange={handleChange} />
                  <FormInput label="DNI" name="dni" type="number" required onChange={handleChange} />
                  <FormInput label="Fecha de Nacimiento" name="fecha_nacimiento" type="date" onChange={handleChange} />
                  <FormInput label="Edad" name="edad" type="number" onChange={handleChange} />
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Sexo</label>
                    <select name="sexo" onChange={handleChange} className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]">
                      <option value="">Seleccionar</option>
                      <option value="Masculino">Masculino</option>
                      <option value="Femenino">Femenino</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Estado Civil</label>
                    <select name="estado_civil" onChange={handleChange} className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]">
                      <option value="">Seleccionar</option>
                      <option value="Soltero">Soltero(a)</option>
                      <option value="Casado">Casado(a)</option>
                      <option value="Conviviente">Conviviente</option>
                      <option value="Divorciado">Divorciado(a)</option>
                      <option value="Viudo">Viudo(a)</option>
                    </select>
                  </div>
                  
                  <FormInput label="Teléfono Fijo" name="telefono" type="tel" onChange={handleChange} />
                  <FormInput label="Celular" name="celular" type="tel" onChange={handleChange} />
                  <FormInput label="Email" name="email" type="email" onChange={handleChange} />
                  <FormInput label="RUC" name="ruc" onChange={handleChange} />
                  <FormInput label="Brevete" name="brevete" onChange={handleChange} />
                  <FormInput label="Categoría Brevete" name="categoria_brevete" onChange={handleChange} />
                </div>
                
                <div className="mt-4">
                  <FormInput label="Dirección Actual" name="direccion" onChange={handleChange} />
                  <div className="mt-4">
                    <FormInput label="Referencia de Ubicación" name="referencia" onChange={handleChange} />
                  </div>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                  <FormInput label="Número de Cuenta Bancaria" name="numero_cuenta" onChange={handleChange} />
                  <FormInput label="CCI" name="cci" onChange={handleChange} />
                  <FormInput label="AFP" name="afp" onChange={handleChange} />
                  <FormInput label="Tipo de Comisión AFP" name="comision_afp" onChange={handleChange} />
                  <FormInput label="CUSPP" name="cuspp" onChange={handleChange} />
                </div>
              </Section>

              {/* II. DATOS FAMILIARES */}
              <Section title="II. Datos Familiares" icon={Users} expanded={expandedSections.includes(1)} onToggle={() => toggleSection(1)}>
                <div className="space-y-4">
                  <div className="flex justify-between items-center">
                    <h4 className="font-medium">Familiares Directos</h4>
                    <button
                      type="button"
                      onClick={() => setFamiliares(prev => [...prev, { id: prev.length + 1 }])}
                      className="px-4 py-2 bg-[#0973b0] text-white rounded-lg hover:bg-[#075a90] text-sm"
                    >
                      + Agregar Familiar
                    </button>
                  </div>
                  
                  {familiares.map((fam, idx) => (
                    <div key={fam.id} className="bg-gray-50 p-4 rounded-lg">
                      <div className="flex justify-between items-center mb-3">
                        <span className="text-sm font-semibold">Familiar {idx + 1}</span>
                        {familiares.length > 1 && (
                          <button
                            type="button"
                            onClick={() => setFamiliares(prev => prev.filter(f => f.id !== fam.id))}
                            className="text-red-600 text-sm hover:underline"
                          >
                            Eliminar
                          </button>
                        )}
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <FormInput label="Nombres" name={`familiar_${fam.id}_nombres`} onChange={handleChange} />
                        <FormInput label="Apellido Paterno" name={`familiar_${fam.id}_apellido_paterno`} onChange={handleChange} />
                        <FormInput label="Apellido Materno" name={`familiar_${fam.id}_apellido_materno`} onChange={handleChange} />
                        <FormInput label="DNI" name={`familiar_${fam.id}_dni`} onChange={handleChange} />
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Parentesco</label>
                          <select name={`familiar_${fam.id}_parentesco`} onChange={handleChange} className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]">
                            <option value="">Seleccionar</option>
                            <option value="Padre">Padre</option>
                            <option value="Madre">Madre</option>
                            <option value="Hijo">Hijo(a)</option>
                            <option value="Hermano">Hermano(a)</option>
                            <option value="Conyuge">Cónyuge</option>
                            <option value="Otro">Otro</option>
                          </select>
                        </div>
                        <FormInput label="Fecha Nacimiento" name={`familiar_${fam.id}_fecha_nacimiento`} type="date" onChange={handleChange} />
                      </div>
                    </div>
                  ))}
                </div>
              </Section>

              {/* III. CONTACTOS DE EMERGENCIA */}
              <Section title="III. Contactos de Emergencia" icon={AlertCircle} expanded={expandedSections.includes(2)} onToggle={() => toggleSection(2)}>
                <div className="space-y-4">
                  <div className="flex justify-between items-center">
                    <h4 className="font-medium">Personas a contactar en caso de emergencia</h4>
                    <button
                      type="button"
                      onClick={() => setContactosEmergencia(prev => [...prev, { id: prev.length + 1 }])}
                      className="px-4 py-2 bg-[#0973b0] text-white rounded-lg hover:bg-[#075a90] text-sm"
                    >
                      + Agregar Contacto
                    </button>
                  </div>
                  
                  {contactosEmergencia.map((cont, idx) => (
                    <div key={cont.id} className="bg-gray-50 p-4 rounded-lg">
                      <div className="flex justify-between items-center mb-3">
                        <span className="text-sm font-semibold">Contacto {idx + 1}</span>
                        {contactosEmergencia.length > 1 && (
                          <button
                            type="button"
                            onClick={() => setContactosEmergencia(prev => prev.filter(c => c.id !== cont.id))}
                            className="text-red-600 text-sm hover:underline"
                          >
                            Eliminar
                          </button>
                        )}
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <FormInput label="Nombre Completo" name={`contacto_${cont.id}_nombre`} onChange={handleChange} />
                        <FormInput label="Vínculo" name={`contacto_${cont.id}_vinculo`} onChange={handleChange} />
                        <FormInput label="Teléfono" name={`contacto_${cont.id}_telefono`} type="tel" onChange={handleChange} />
                      </div>
                    </div>
                  ))}
                </div>
              </Section>

              {/* IV. FORMACIÓN ACADÉMICA */}
              <Section title="IV. Formación Académica" icon={GraduationCap} expanded={expandedSections.includes(3)} onToggle={() => toggleSection(3)}>
                <div className="space-y-4">
                  <div className="flex justify-between items-center">
                    <h4 className="font-medium">Estudios Realizados</h4>
                    <button
                      type="button"
                      onClick={() => setEstudios(prev => [...prev, { id: prev.length + 1 }])}
                      className="px-4 py-2 bg-[#0973b0] text-white rounded-lg hover:bg-[#075a90] text-sm"
                    >
                      + Agregar Estudio
                    </button>
                  </div>
                  
                  {estudios.map((est, idx) => (
                    <div key={est.id} className="bg-gray-50 p-4 rounded-lg">
                      <div className="flex justify-between items-center mb-3">
                        <span className="text-sm font-semibold">Estudio {idx + 1}</span>
                        {estudios.length > 1 && (
                          <button
                            type="button"
                            onClick={() => setEstudios(prev => prev.filter(e => e.id !== est.id))}
                            className="text-red-600 text-sm hover:underline"
                          >
                            Eliminar
                          </button>
                        )}
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Nivel</label>
                          <select name={`estudio_${est.id}_nivel`} onChange={handleChange} className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]">
                            <option value="">Seleccionar</option>
                            <option value="Primaria">Primaria</option>
                            <option value="Secundaria">Secundaria</option>
                            <option value="Técnico">Técnico</option>
                            <option value="Superior">Superior</option>
                            <option value="Postgrado">Postgrado</option>
                          </select>
                        </div>
                        <FormInput label="Institución" name={`estudio_${est.id}_institucion`} onChange={handleChange} />
                        <FormInput label="Especialidad/Carrera" name={`estudio_${est.id}_especialidad`} onChange={handleChange} />
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Grado Obtenido</label>
                          <select name={`estudio_${est.id}_grado`} onChange={handleChange} className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]">
                            <option value="">Seleccionar</option>
                            <option value="Completo">Completo</option>
                            <option value="Incompleto">Incompleto</option>
                            <option value="Estudiando">Estudiando</option>
                            <option value="Egresado">Egresado</option>
                            <option value="Titulado">Titulado</option>
                            <option value="Bachiller">Bachiller</option>
                          </select>
                        </div>
                        <FormInput label="Año Inicio" name={`estudio_${est.id}_anio_inicio`} type="number" onChange={handleChange} />
                        <FormInput label="Año Fin" name={`estudio_${est.id}_anio_fin`} type="number" onChange={handleChange} />
                      </div>
                    </div>
                  ))}
                </div>
              </Section>

              {/* V. EXPERIENCIA LABORAL */}
              <Section title="V. Experiencia Laboral" icon={Briefcase} expanded={expandedSections.includes(4)} onToggle={() => toggleSection(4)}>
                <div className="space-y-6">
                  <label className="inline-flex items-center">
                    <input type="checkbox" name="sin_experiencia" onChange={handleChange} className="text-[#0973b0] rounded" />
                    <span className="ml-2 font-medium">Sin Experiencia Laboral</span>
                  </label>

                  {!formData.sin_experiencia && (
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium">Experiencias Anteriores</h4>
                        <button
                          type="button"
                          onClick={() => setExperiencias(prev => [...prev, { id: prev.length + 1 }])}
                          className="px-4 py-2 bg-[#0973b0] text-white rounded-lg hover:bg-[#075a90] text-sm"
                        >
                          + Agregar Experiencia
                        </button>
                      </div>
                      
                      {experiencias.map((exp, idx) => (
                        <div key={exp.id} className="bg-gray-50 p-4 rounded-lg">
                          <div className="flex justify-between items-center mb-3">
                            <span className="text-sm font-semibold">Experiencia {idx + 1}</span>
                            {experiencias.length > 1 && (
                              <button
                                type="button"
                                onClick={() => setExperiencias(prev => prev.filter(e => e.id !== exp.id))}
                                className="text-red-600 text-sm hover:underline"
                              >
                                Eliminar
                              </button>
                            )}
                          </div>
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <FormInput label="Organización/Empresa" name={`exp_${exp.id}_org`} onChange={handleChange} />
                            <FormInput label="Cargo" name={`exp_${exp.id}_cargo`} onChange={handleChange} />
                            <FormInput label="Tiempo (meses)" name={`exp_${exp.id}_tiempo`} type="number" onChange={handleChange} />
                          </div>
                          <div className="mt-4">
                            <label className="block text-sm font-medium text-gray-700 mb-2">Motivo de Cese:</label>
                            <textarea
                              name={`exp_${exp.id}_motivo`}
                              onChange={handleChange}
                              className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-[#0973b0]"
                              rows={2}
                            />
                          </div>
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                            <FormInput label="Jefe Inmediato" name={`exp_${exp.id}_jefe`} onChange={handleChange} />
                            <FormInput label="Cargo del Jefe" name={`exp_${exp.id}_cargo_jefe`} onChange={handleChange} />
                            <FormInput label="Teléfono de Referencia" name={`exp_${exp.id}_telefono_jefe`} type="tel" onChange={handleChange} />
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </Section>

              {/* VI. DOCUMENTOS ADJUNTOS */}
              <Section title="VI. Documentos Adjuntos" icon={Paperclip} expanded={expandedSections.includes(5)} onToggle={() => toggleSection(5)}>
                <div className="space-y-4">
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                    <p className="text-sm text-yellow-800">
                      📌 <strong>Nota:</strong> Los archivos deben ser menores a 10MB. Formatos aceptados: PDF, JPG, PNG
                    </p>
                  </div>
                  
                  <FileUpload
                    label="DNI (frente)"
                    required
                    keyName="dni_frente"
                    accept="image/*,.pdf"
                    onChange={(e) => handleFileChange('dni_frente', e)}
                    selected={attachments.dni_frente}
                  />
                  
                  <FileUpload
                    label="DNI (reverso)"
                    keyName="dni_reverso"
                    accept="image/*,.pdf"
                    onChange={(e) => handleFileChange('dni_reverso', e)}
                    selected={attachments.dni_reverso}
                  />
                  
                  <FileUpload
                    label="CV Documentado"
                    required
                    keyName="cv"
                    accept=".pdf,.doc,.docx"
                    onChange={(e) => handleFileChange('cv', e)}
                    selected={attachments.cv}
                  />
                  
                  <FileUpload
                    label="Certificado de Vacunación COVID-19"
                    required
                    keyName="vacuna"
                    accept="image/*,.pdf"
                    onChange={(e) => handleFileChange('vacuna', e)}
                    selected={attachments.vacuna}
                  />
                  
                  <FileUpload
                    label="Certificado CERTIADULTO (opcional)"
                    keyName="certiadulto"
                    accept="image/*,.pdf"
                    onChange={(e) => handleFileChange('certiadulto', e)}
                    selected={attachments.certiadulto}
                  />
                </div>
              </Section>

              {/* VII. TÉRMINOS Y CONDICIONES */}
              <Section title="VII. Términos y Condiciones" icon={CheckCircle} expanded={expandedSections.includes(6)} onToggle={() => toggleSection(6)}>
                <div className="bg-gray-50 p-6 rounded-lg">
                  <div className="mb-4">
                    <h4 className="font-semibold mb-2">Declaración y Autorización</h4>
                    <p className="text-sm text-gray-600 mb-2">
                      Declaro que la información proporcionada en este formulario es verídica y completa. 
                      Entiendo que cualquier falsedad u omisión puede ser causal de descalificación del proceso 
                      de selección o de despido si ya estuviera laborando.
                    </p>
                    <p className="text-sm text-gray-600">
                      Autorizo a la Empresa Comunal de Servicios Múltiples de la Comunidad Campesina de Taca 
                      a utilizar mis datos personales exclusivamente para fines de gestión de recursos humanos, 
                      conforme a la Ley N° 29733 - Ley de Protección de Datos Personales.
                    </p>
                  </div>
                  
                  <label className="flex items-start">
                    <input
                      type="checkbox"
                      name="acepta_terminos"
                      onChange={handleChange}
                      className="mt-1 text-[#0973b0] rounded"
                      required
                    />
                    <span className="ml-3 text-sm">
                      He leído y acepto los términos y condiciones <span className="text-red-600">*</span>
                    </span>
                  </label>
                </div>
              </Section>

              {/* BOTÓN DE ENVÍO */}
              <div className="pt-6">
                <button
                  type="submit"
                  disabled={loading}
                  className={`w-full py-4 px-6 rounded-lg shadow-lg font-medium text-lg flex items-center justify-center gap-2 transition-all ${
                    loading
                      ? 'bg-gray-400 cursor-not-allowed'
                      : 'bg-[#0973b0] hover:bg-[#075a90] text-white'
                  }`}
                >
                  {loading ? (
                    <>
                      <div className="loader"></div>
                      <span>Enviando...</span>
                    </>
                  ) : (
                    <>
                      <CheckCircle size={20} />
                      <span>Enviar Postulación</span>
                    </>
                  )}
                </button>
              </div>
            </form>

            {/* FOOTER */}
            <div className="text-center mt-8 py-4 border-t">
              <p className="text-sm text-gray-600">
                © 2024 Empresa Comunal de Servicios Múltiples - Comunidad Campesina de Taca
              </p>
              <p className="text-xs text-gray-500 mt-1">
                Todos los derechos reservados
              </p>
            </div>
          </div>
        </div>
      );
    }

    // ========================================
    // RENDERIZAR LA APLICACIÓN
    // ========================================
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FichaDatos />);
  </script>
</body>
</html>
